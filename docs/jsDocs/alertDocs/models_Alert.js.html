<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/Alert.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/Alert.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//@ts-check

/**
 * Classe parent das subclasses de alerta.  
 */
class Alert {

    /** @property {any[]} expiringItems Elementos prestes a vencer*/
    expiringItems = []

    /**
     * @property {string} subject Assunto da mensagem (e-mail)     
     */
    subject;

    /** @property {number[]} prazos Prazos para a cria√ß√£o e envio de alertas */
    prazos;

    /** @property {string} dbQuery Query SELECT passada para o banco de dados*/
    dbQuery;

    /** @property {any[]} mailFields Campos correspondentes no DB que devem aparecer na tabela que consta na mensagem*/
    mailFields = []

    /** @property {string} messageIntro Texto de introdu√ß√£o da mensagem*/
    messageIntro;

    /** @property {string[]} mailHeaders Cabe√ßalho da tabela contida na mensagem*/
    mailHeaders;

    /** @property {string} messageTip Orienta√ß√£o para como resolver o alerta*/
    messageTip;

    /** @property {string} tipPath Orienta√ß√£o para onde no sistema achar a resolu√ß√£o do alerta*/
    tipPath;

    /** @property {*} recipients Orienta√ß√£o para onde no sistema achar a resolu√ß√£o do alerta*/
    recipients;

    /**Filtra os itens (ex: ap√≥lice, procura√ß√£o, etc) que est√£o a vencer por empresa, para concentrar todos de uma determinada empresa em um s√≥ e-mail.
    * @param {Number} codigo_empresa C√≥digo da empresa/delegat√°rio no banco de dados Posgresql
    * @returns Retorna uma array objetos, por ex: ap√≥lices de seguros ou procura√ß√µes a vencer agrupadas por empresa
    */
    getEmpresaExpiringItems(codigo_empresa, expiringItems) {
        const expiringEmpresaItems = expiringItems
            .filter(a => a.codigo_empresa === codigo_empresa)
            .map((/** @type {{ any }} */ item) => {
                const obj = {}
                this.mailFields.forEach(f => Object.assign(obj, { [f]: item[f] }))
                return obj
            })

        return expiringEmpresaItems
    }

    /**
     * Cria a mensagem que ser√° enviada por e-mail. A mensagem √© dividida em intro, details, tip e tipPath.
     * intro cont√©m o in√≠cio da mensagem, com o conte√∫do do que se trata; * details s√£o os detalhes que v√™m dos objetos gerados em getEmpresaExpiredItems;
     * tip √© a orienta√ß√£o para como resolver o alerta; * tipPath √© o caminho que deve ser percorrido no sistema para resolver o alerta.
     * @param {array} expiringEmpresaItems - array de objetos com as props (ex: { numero, vencimento, etc }), gerados no getEmpresaExpiringItems
     * @returns {object} objeto com a mensagem dividida em partes (intro, details, tip e tipPath) para a formata√ß√£o e envio do e-mail.
     */
    createMessage(expiringEmpresaItems) {
        //console.log("üöÄ ~ file: SeguroAlert.js ~ line 30 ~ SeguroAlert ~ createMessage ~ apolices", apolices)

        if (expiringEmpresaItems.length > 0) {

            const message = {
                intro: this.messageIntro,
                tableHeaders: this.mailHeaders,
                tableData: expiringEmpresaItems,
                tip: this.messageTip,
                tipPath: this.tipPath
            }
            return message
        }
    }
}

module.exports = Alert
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">CADTI - Microsservi√ßo de alertas / avisos </a></h2><h3>Modules</h3><ul><li><a href="module-AlertFactory.html">AlertFactory</a></li><li><a href="module-AlertService.html">AlertService</a></li><li><a href="module-RecipientService.html">RecipientService</a></li></ul><h3>Classes</h3><ul><li><a href="Alert.html">Alert</a></li><li><a href="LaudoAlert.html">LaudoAlert</a></li><li><a href="module-AlertFactory-AlertFactory.html">AlertFactory</a></li><li><a href="module-AlertService-AlertService.html">AlertService</a></li><li><a href="ProcuracaoAlert.html">ProcuracaoAlert</a></li><li><a href="SeguroAlert.html">SeguroAlert</a></li></ul><h3>Global</h3><ul><li><a href="global.html#main">main</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Sep 07 2021 20:57:03 GMT-0300 (GMT-03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
