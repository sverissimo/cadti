<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/ProcuracaoAlert.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/ProcuracaoAlert.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//@ts-check
const
    Alert = require("./Alert"),
    { procuracoes: getAllProcs } = require("../../allGetQueries"),
    procuracoes = getAllProcs()


/**
 * Classe instanciada de Alert com m√©todos espec√≠ficos para o alerta sobre o vencimento de procura√ß√µes
 * @extends Alert
 */
class ProcuracaoAlert extends Alert {

    /** @type {Object} */
    recipients;

    /**
     * 
     * @param {Array&lt;number>} prazos 
     */
    constructor(prazos) {
        super()
        this.subject = 'Vencimento de procura√ß√µes.'
        this.prazos = prazos
        this.dbQuery = procuracoes
        this.messageIntro = 'As procura√ß√µes abaixo se encontram pr√≥ximas do vencimento:'
        this.mailFields = ['procuradores', 'vencimento']
        this.mailHeaders = ['Procuradores', 'Vencimento']
        this.messageTip = 'Para atualizar ou cadastrar uma nova procura√ß√£o'
        this.tipPath = '\"Empresas\" >> \"Procuradores\".'
    }

    /**Filtra os itens (ex: ap√≥lice, procura√ß√£o, etc) que est√£o a vencer por empresa, para concentrar todos de uma determinada empresa em um s√≥ e-mail.
    * @override
    * @param {Number} codigo_empresa C√≥digo da empresa/delegat√°rio no banco de dados Posgresql
    * @returns Retorna uma array objetos, por ex: ap√≥lices de seguros ou procura√ß√µes a vencer agrupadas por empresa
    */
    getEmpresaExpiringItems(codigo_empresa, expiringItems) {
        const expiringEmpresaItems = expiringItems
            .filter(a => a.codigo_empresa === codigo_empresa)
            .map((/** @type {{ any }} */ item) => {
                const obj = {}
                this.mailFields.forEach(f => Object.assign(obj, { [f]: item[f] }))
                this.addProcsName(obj)
                return obj
            })

        return expiringEmpresaItems
    }

    /**
    * Adiciona os nomes dos procuradores em um objeto que tenha array de procurador_id. M√©todo espec√≠fico para as subClasses que implementarem (ex: ProcuracaoAlert)
    * @param {object} expiringProcuracao - item a expirar (criado pelo m√©todo this.getEmpresaExpiringItems)
    */
    addProcsName(expiringProcuracao) {
        if (this.recipients) {
            const { procuradores } = this.recipients

            console.log("üöÄ ~ file: ProcuracaoAlert.js ~ line 52 ~ ProcuracaoAlert ~ expiringProcuracao.procuradores.forEach ~ expiringProcuracao", expiringProcuracao)
            expiringProcuracao.procuradores.forEach((procId, i) => {
                const
                    procurador = procuradores.find(p => p.nome_procurador &amp;&amp; p.procurador_id === procId)
                    , name = procurador &amp;&amp; procurador.nome_procurador
                expiringProcuracao.procuradores[i] = name
            });
        }
        expiringProcuracao.procuradores = expiringProcuracao.procuradores.sort()
        return expiringProcuracao
    }
}

module.exports = ProcuracaoAlert
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">CADTI - Microsservi√ßo de alertas / avisos </a></h2><h3>Modules</h3><ul><li><a href="module-AlertFactory.html">AlertFactory</a></li><li><a href="module-AlertService.html">AlertService</a></li><li><a href="module-RecipientService.html">RecipientService</a></li></ul><h3>Classes</h3><ul><li><a href="Alert.html">Alert</a></li><li><a href="LaudoAlert.html">LaudoAlert</a></li><li><a href="module-AlertFactory-AlertFactory.html">AlertFactory</a></li><li><a href="module-AlertService-AlertService.html">AlertService</a></li><li><a href="ProcuracaoAlert.html">ProcuracaoAlert</a></li><li><a href="SeguroAlert.html">SeguroAlert</a></li></ul><h3>Global</h3><ul><li><a href="global.html#main">main</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Sep 07 2021 20:57:03 GMT-0300 (GMT-03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
